<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>BEVE POWER | QR Cell Decoder</title>
<meta name="description" content="Decode GREAT POWER cell QR codes for BEVE POWER TITAN batteries — Manual entry or camera scan (GitHub Pages ready)." />
<link rel="icon" href="assets/favicon.svg" type="image/svg+xml" />
<style>
  :root{ --brand:#d92323; --bg:#fafafa; --card:#fff; --text:#222; --muted:#666; --border:#e9e9e9; }
  body{ margin:0; background:var(--bg); color:var(--text); font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial; }
  header{ background:#fff; text-align:center; box-shadow:0 1px 8px rgba(0,0,0,.06); padding:14px; position:sticky; top:0; z-index:10; }
  header img{ max-width:220px; width:100%; height:auto; }
  h1{ color:var(--brand); font-size:1.5rem; margin:0.5rem 0 0; }
  main{ max-width:960px; margin:auto; padding:1rem; }
  .card{ background:#fff; border-radius:12px; box-shadow:0 2px 8px rgba(0,0,0,.05); padding:1rem; margin:1rem 0; }
  label{ display:block; font-weight:600; margin-top:.5rem; }
  input[type=text]{ width:100%; padding:.7rem; font-size:1rem; border:1px solid var(--border); border-radius:8px; margin-bottom:.5rem; }
  button{ background:var(--brand); color:#fff; border:none; border-radius:8px; padding:.6rem 1rem; font-size:1rem; cursor:pointer; margin:.25rem; }
  button.secondary{ background:#444; }
  button:disabled{ background:#aaa; cursor:not-allowed; }
  #reader{ min-height:260px; border:1px dashed var(--border); border-radius:12px; display:flex; align-items:center; justify-content:center; margin-top:10px; }
  .muted{ color:var(--muted); font-size:.9rem; }
  footer{ text-align:center; color:#777; padding:1rem; font-size:.9rem; }
</style>
</head>
<body>
<header>
  <img src="https://i.postimg.cc/v8CLk3Nv/Screenshot-2025-09-28-104524.png" alt="BEVE POWER Logo" />
  <h1>QR Cell Decoder</h1>
</header>

<main>
  <section class="card">
    <p class="muted">Manual entry always works. Camera scanning available online only (uses Html5Qrcode library via CDN).</p>

    <label for="qrInput">QR Payload</label>
    <input id="qrInput" type="text" placeholder="Paste QR or wait for scan..." />
    <div>
      <button onclick="decodeInput()">Decode</button>
      <button class="secondary" onclick="clearAll()">Clear</button>
    </div>

    <div style="margin-top:1rem;">
      <button id="startBtn" onclick="startCamera()">Start Camera</button>
      <button id="stopBtn" class="secondary" onclick="stopCamera()" disabled>Stop Camera</button>
    </div>

    <div id="reader">Camera preview will appear here.</div>
    <p id="result" class="muted"></p>
  </section>

  <section id="decodedCard" class="card" style="display:none;">
    <h2>Decoded Information</h2>
    <div><b>Cell Type:</b> <span id="cellType"></span></div>
    <div><b>Capacity:</b> <span id="capacity"></span></div>
    <div><b>Voltage:</b> <span id="voltage"></span></div>
    <div><b>Production Base:</b> <span id="base"></span></div>
    <div><b>Production Date:</b> <span id="date"></span></div>
    <div><b>Serial:</b> <span id="serial"></span></div>
    <p id="notes" class="muted"></p>
  </section>
</main>

<footer>© <span id="yearNow"></span> BEVE POWER</footer>

<script src="https://unpkg.com/html5-qrcode@2.3.7/minified/html5-qrcode.min.js"></script>
<script>
document.getElementById('yearNow').textContent = new Date().getFullYear();
let scanner = null;

const yearMap={'B':2021,'C':2022,'D':2023,'E':2024,'F':2025,'G':2026,'H':2027};
const monthMap={'1':'Jan','2':'Feb','3':'Mar','4':'Apr','5':'May','6':'Jun','7':'Jul','8':'Aug','9':'Sep','A':'Oct','B':'Nov','C':'Dec'};
const dateMap={'1':1,'2':2,'3':3,'4':4,'5':5,'6':6,'7':7,'8':8,'9':9,'A':10,'B':11,'C':12,'D':13,'E':14,'F':15,'G':16,'H':17,'J':18,'K':19,'L':20,'M':21,'N':22,'P':23,'R':24,'S':25,'T':26,'V':27,'W':28,'X':29,'Y':30,'O':31};

function decodeCell(qr){
  qr = qr.trim().toUpperCase();
  const serial = qr.match(/\d{5,}$/)?.[0] || 'Unknown';
  const before = qr.slice(0, -serial.length);
  const dateC = before.slice(-1), monthC = before.slice(-2,-1), yearC = before.slice(-3,-2);
  const year = yearMap[yearC] || 'Unknown';
  const month = monthMap[monthC] || 'Unknown';
  const day = dateMap[dateC] || 'Unknown';
  const capacity = qr.includes('100')?'100Ah':qr.includes('300')?'300Ah':'Unknown';
  return {year,month,day,serial,capacity};
}

function decodeInput(){
  const qr = document.getElementById('qrInput').value;
  const r = decodeCell(qr);
  document.getElementById('decodedCard').style.display='block';
  document.getElementById('cellType').textContent='GREAT POWER';
  document.getElementById('capacity').textContent=r.capacity;
  document.getElementById('voltage').textContent='3.2V';
  document.getElementById('base').textContent='BEVE Factory';
  document.getElementById('date').textContent=`${r.day} ${r.month} ${r.year}`;
  document.getElementById('serial').textContent=r.serial;
  document.getElementById('notes').textContent='Decoded successfully.';
}

function clearAll(){
  document.getElementById('qrInput').value='';
  document.getElementById('decodedCard').style.display='none';
  document.getElementById('result').textContent='';
  if(scanner){scanner.clear(); scanner=null;}
  document.getElementById('stopBtn').disabled=true;
  document.getElementById('startBtn').disabled=false;
}

function startCamera(){
  if(!navigator.onLine){ alert('You must be online to use the camera scanner.'); return; }
  document.getElementById('result').textContent='Starting camera...';
  scanner = new Html5QrcodeScanner("reader", { fps: 10, qrbox: 250 });
  scanner.render(onScanSuccess, onScanFailure);
  document.getElementById('startBtn').disabled=true;
  document.getElementById('stopBtn').disabled=false;
}

function stopCamera(){
  if(scanner){
    document.getElementById('reader').innerHTML='Camera stopped.';
    scanner.clear();
    scanner=null;
  }
  document.getElementById('startBtn').disabled=false;
  document.getElementById('stopBtn').disabled=true;
}

function onScanSuccess(decodedText, decodedResult){
  document.getElementById('result').innerText = `Scanned: ${decodedText}`;
  document.getElementById('qrInput').value = decodedText;
  decodeInput();
  stopCamera();
}

function onScanFailure(error){
  console.warn(`QR error = ${error}`);
}
</script>
</body>
</html>
