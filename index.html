<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Battery QR Decoder | BEVE Power</title>
  <link rel="icon" href="https://i.postimg.cc/v8CLk3Nv/Screenshot-2025-09-28-104524.png">
  <style>
:root{
  --bg:#ffffff;--card:#ffffff;--ink:#0f1115;--muted:#6b7280;--muted-2:#4b5563;
  --brand:#e41f26;--brand-600:#c7191e;--ring:rgba(228,31,38,.35);
  --shade-1:rgba(17,17,17,.06);--shade-2:rgba(17,17,17,.04);
  --field-bg:#ffffff;--result-bg:#fff5f5;
}
*{box-sizing:border-box;margin:0;padding:0}
html,body{height:100%}
body{
  font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
  background:var(--bg);color:var(--ink);
  display:flex;align-items:center;justify-content:center;
  padding:20px;
}
.card{background:var(--card);padding:28px 26px;border-radius:16px;box-shadow:0 10px 30px var(--shade-1);
  max-width:720px;width:100%;text-align:center;border:1px solid rgba(20,20,30,.06)}
.logo{height:60px;max-width:280px;display:block;margin:0 auto 14px}
h2{margin:0 0 10px;font-size:clamp(1.3rem,2.5vw,1.6rem);font-weight:800;color:var(--brand)}
p.hint{margin:0 0 16px;color:var(--muted);font-size:.94rem}
label{display:block;margin-top:14px;font-weight:700;font-size:.95rem;text-align:left}
input[type=text]{width:100%;padding:12px 14px;border-radius:10px;border:1px solid rgba(120,130,150,.25);
  margin-top:6px;background:var(--field-bg);color:var(--ink);outline:none}
input[type=text]:focus{border-color:var(--brand);box-shadow:0 0 0 4px var(--ring)}
button{margin-top:14px;padding:11px 16px;border-radius:10px;border:0;background:var(--brand);
  color:white;font-weight:800;cursor:pointer;box-shadow:0 6px 14px rgba(228,31,38,.18)}
button:hover{background:var(--brand-600)}
#stopScan{background:#6b7280;box-shadow:0 6px 14px rgba(107,114,128,.18)}
#stopScan:hover{background:#555b66}
.row{margin-top:12px;display:grid;gap:12px;grid-template-columns:repeat(auto-fit,minmax(160px,1fr));align-items:start;text-align:center}
#reader{width:100%;max-width:520px;margin:18px auto 0;display:none;border-radius:14px;overflow:hidden;background:var(--field-bg);
  border:1px dashed rgba(120,130,150,.35);aspect-ratio:4/3}
.result{margin-top:18px;padding:14px;border-radius:12px;background:var(--result-bg);border:1px solid rgba(228,31,38,.15);text-align:left}
.field{margin:8px 0;padding:10px 12px;border-radius:10px;background:var(--field-bg)}
.label{display:block;font-size:.76rem;color:var(--muted);margin-bottom:4px;text-transform:uppercase}
.value{font-weight:900;color:var(--brand);word-break:break-word}
footer{font-size:.86rem;color:var(--muted);margin-top:20px;text-align:center}
.note{margin-top:10px;color:#8a2d2f;font-size:.9rem}
  </style>

  <!-- Prefer cdnjs, fallback to unpkg; both HTTPS for GitHub Pages -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html5-qrcode/2.3.8/html5-qrcode.min.js"
          integrity="sha512-8QRRb9q6Q6zP2R6r9/90F1pF9SJK6CzCpbX98Xn2rK8YSkT3xqS7u2kq5g0mC0m0L+9a6oU2YwQy3mPq9a3CMQ=="
          crossorigin="anonymous"
          referrerpolicy="no-referrer"
          onerror="var s=document.createElement('script');s.src='https://unpkg.com/html5-qrcode/minified/html5-qrcode.min.js';document.head.appendChild(s);">
  </script>

  <!-- Our custom logic (deferred) -->
  <script defer>
document.addEventListener('DOMContentLoaded', function(){
  // Guard: verify library loaded
  function ensureLib(){
    if (window.Html5Qrcode) return true;
    const msg = 'QR library failed to load. If you are on GitHub Pages behind a firewall or CDN is blocked, download html5-qrcode.min.js and serve it locally.';
    console.error(msg);
    const note = document.getElementById('libNote');
    if (note) note.textContent = msg + ' (See README notes in the repo).';
    return false;
  }

  const yearMap={'A':2020,'B':2021,'C':2022,'D':2023,'E':2024,'F':2025,'G':2026};
  const monthMap={'1':1,'2':2,'3':3,'4':4,'5':5,'6':6,'7':7,'8':8,'9':9,'A':10,'B':11,'C':12};
  const dateMap={'P':23};const baseMap={'C':'Henan'};const voltageMap={'6':'3.2V'};const versionMap={'1':'v1.0'};

  function decodeSerial(sn){
    if(!sn||sn.length<18)return null;sn=sn.trim().toUpperCase();
    return{raw:sn,manufacturer:sn.substring(0,4),series:sn.substring(4,7),
      version:versionMap[sn[7]]||('v'+sn[7]),voltage:voltageMap[sn[8]]||(sn[8]+' code'),
      capacity:sn.substring(9,12)+' Ah',productionLine:sn[12],
      factoryBase:baseMap[sn[13]]||sn[13],
      productionDate:(yearMap[sn[14]]||'')+'-'+(monthMap[sn[15]]||'')+'-'+(dateMap[sn[16]]||sn[16]),
      batch:sn.substring(17)};
  }

  function renderInfo(info){
    const out=document.getElementById('out');
    if(!info){out.innerHTML='<strong>No valid data detected.</strong>';return;}
    out.innerHTML=`
      <div class="field"><span class="label">Raw Serial</span><div class="value">${info.raw}</div></div>
      <div class="field"><span class="label">Manufacturer</span><div class="value">${info.manufacturer}</div></div>
      <div class="field"><span class="label">Series</span><div class="value">${info.series}</div></div>
      <div class="field"><span class="label">Version</span><div class="value">${info.version}</div></div>
      <div class="field"><span class="label">Voltage</span><div class="value">${info.voltage}</div></div>
      <div class="field"><span class="label">Capacity</span><div class="value">${info.capacity}</div></div>
      <div class="field"><span class="label">Production Line</span><div class="value">${info.productionLine}</div></div>
      <div class="field"><span class="label">Factory Base</span><div class="value">${info.factoryBase}</div></div>
      <div class="field"><span class="label">Production Date</span><div class="value">${info.productionDate}</div></div>
      <div class="field"><span class="label">Batch</span><div class="value">${info.batch}</div></div>`;
  }

  document.getElementById('decodeBtn').addEventListener('click',()=>{
    renderInfo(decodeSerial(document.getElementById('qr').value));
  });

  let html5QrCode;
  const readerDiv=document.getElementById('reader');
  const startBtn=document.getElementById('startScan');
  const stopBtn=document.getElementById('stopScan');

  startBtn.addEventListener('click',()=>{
    if(!ensureLib()){ alert('QR library did not load. See console for details.'); return; }
    navigator.mediaDevices.getUserMedia({video:true}).then(stream=>{
      stream.getTracks().forEach(t=>t.stop());
      readerDiv.style.display='block';startBtn.style.display='none';stopBtn.style.display='inline-block';
      html5QrCode=new Html5Qrcode('reader');
      html5QrCode.start({facingMode:"environment"},{fps:10,qrbox:250},msg=>{
        document.getElementById('qr').value=msg;renderInfo(decodeSerial(msg));
      },()=>{}).catch(e=>alert('Camera start failed: '+e));
    }).catch(err=>alert('Camera permission denied: '+err));
  });

  stopBtn.addEventListener('click',()=>{
    if(html5QrCode){
      html5QrCode.stop().then(()=>{
        readerDiv.style.display='none';stopBtn.style.display='none';startBtn.style.display='inline-block';
      });
    }
  });
});
  </script>
</head>
<body>
  <div class="card">
    <img class="logo" src="https://i.postimg.cc/v8CLk3Nv/Screenshot-2025-09-28-104524.png" alt="BEVE Power Logo" />
    <h2>Battery QR Code Decoder</h2>
    <p class="hint">Enter the cellâ€™s serial or QR code manually, or scan it using your deviceâ€™s camera.</p>
    <div id="libNote" class="note"></div>
    <label for="qr">QR / Serial Number</label>
    <input id="qr" type="text" placeholder="Example: 02KCBB416280GCF4P1101411" />
    <div class="row">
      <div class="col"><button id="decodeBtn">Decode Information</button></div>
      <div class="col">
        <button id="startScan">ðŸ“· Activate Camera</button>
        <button id="stopScan" style="display:none;">Stop Camera</button>
      </div>
    </div>
    <div id="reader"></div>
    <div id="out" class="result"><div style="color:#666">Awaiting input or scan results...</div></div>
    <footer>For GitHub Pages: site must be served over HTTPS. If your network blocks CDNs, download <code>html5-qrcode.min.js</code> and reference it locally as <code>&lt;script src="./vendor/html5-qrcode.min.js"&gt;</code>.</footer>
  </div>
</body>
</html>
