<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Battery QR Decoder | BEVE Power</title>
  <link rel="icon" href="https://i.postimg.cc/v8CLk3Nv/Screenshot-2025-09-28-104524.png">
  <style>
:root{
  --bg:#ffffff;--card:#ffffff;--ink:#0f1115;--muted:#6b7280;--muted-2:#4b5563;
  --brand:#e41f26;--brand-600:#c7191e;--ring:rgba(228,31,38,.35);
  --shade-1:rgba(17,17,17,.06);--shade-2:rgba(17,17,17,.04);
  --field-bg:#ffffff;--result-bg:#fff5f5;
  --ok:#12a150;--ok-bg:#e6f6ec;--ok-br:rgba(18,161,80,.35);
}
*{box-sizing:border-box;margin:0;padding:0}
html,body{height:100%}
body{
  font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
  background:var(--bg);color:var(--ink);
  display:flex;align-items:center;justify-content:center;
  padding:20px;
}
.card{background:var(--card);padding:28px 26px;border-radius:16px;box-shadow:0 10px 30px var(--shade-1);
  max-width:820px;width:100%;border:1px solid rgba(20,20,30,.06)}
.logo{height:60px;max-width:280px;display:block;margin:0 auto 14px}
h2{margin:0 0 10px;font-size:clamp(1.3rem,2.5vw,1.6rem);font-weight:800;color:var(--brand);text-align:center}
p.hint{margin:0 0 16px;color:var(--muted);font-size:.94rem;text-align:center}

/* Form */
label{display:block;margin-top:14px;font-weight:700;font-size:.95rem}
input[type=text]{width:100%;padding:12px 14px;border-radius:10px;border:1px solid rgba(120,130,150,.25);
  margin-top:6px;background:var(--field-bg);color:var(--ink);outline:none}
input[type=text]:focus{border-color:var(--brand);box-shadow:0 0 0 4px var(--ring)}
button{margin-top:14px;padding:11px 16px;border-radius:10px;border:0;background:var(--brand);
  color:white;font-weight:800;cursor:pointer;box-shadow:0 6px 14px rgba(228,31,38,.18)}
button:hover{background:var(--brand-600)}
#stopScan{background:#6b7280}
.row{margin-top:12px;display:grid;gap:12px;grid-template-columns:repeat(auto-fit,minmax(160px,1fr));align-items:start}

/* Reader */
#reader{width:100%;max-width:520px;margin:18px auto 0;display:none;border-radius:14px;overflow:hidden;background:var(--field-bg);
  border:1px dashed rgba(120,130,150,.35);aspect-ratio:4/3}

/* Highlight banner */
.highlight-wrap{display:flex;justify-content:center;margin-top:16px}
.highlight{
  display:inline-flex;align-items:center;gap:10px;flex-wrap:wrap;
  padding:10px 14px;border-radius:12px;background:var(--result-bg);
  border:1px solid rgba(228,31,38,.18);
}
.pill{
  display:inline-block;padding:6px 10px;border-radius:999px;
  background:var(--ok-bg);color:var(--ok);font-weight:900;border:1px solid var(--ok-br);
}
.sep{opacity:.45}

/* Results table */
.result{margin-top:14px;padding:14px;border-radius:12px;background:#fff;border:1px solid rgba(120,130,150,.12)}
.field{margin:8px 0;padding:10px 12px;border-radius:10px;background:var(--field-bg);border:1px solid rgba(120,130,150,.12)}
.label{display:block;font-size:.76rem;color:var(--muted);margin-bottom:4px;text-transform:uppercase}
.value{font-weight:900;color:var(--brand);word-break:break-word}

/* Footer */
footer{font-size:.86rem;color:var(--muted);margin-top:20px;text-align:center}
  </style>

  <!-- QR Library with fallback -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html5-qrcode/2.3.8/html5-qrcode.min.js"
          crossorigin="anonymous"
          referrerpolicy="no-referrer"
          onerror="var s=document.createElement('script');s.src='https://unpkg.com/html5-qrcode/minified/html5-qrcode.min.js';document.head.appendChild(s);">
  </script>

  <script defer>
document.addEventListener('DOMContentLoaded', function(){
  function ensureLib(){ return !!window.Html5Qrcode; }

  const yearMap={'A':2020,'B':2021,'C':2022,'D':2023,'E':2024,'F':2025,'G':2026};
  const monthMap={'1':1,'2':2,'3':3,'4':4,'5':5,'6':6,'7':7,'8':8,'9':9,'A':10,'B':11,'C':12};
  const dateMap={'P':23};
  const baseMap={'C':'Henan'};
  const voltageMap={'6':'3.2V'};
  const versionMap={'1':'v1.0'};

  function decodeSerial(sn){
    if(!sn||sn.length<18) return null;
    sn=sn.trim().toUpperCase();
    return {
      raw: sn,
      manufacturer: sn.substring(0,4),
      series: sn.substring(4,7),
      version: versionMap[sn[7]] || ('v' + sn[7]),
      voltage: voltageMap[sn[8]] || (sn[8] + ' code'),
      capacity: sn.substring(9,12) + ' Ah',
      productionLine: sn[12],
      factoryBase: baseMap[sn[13]] || sn[13],
      productionDate: (yearMap[sn[14]]||'') + '-' + (monthMap[sn[15]]||'') + '-' + (dateMap[sn[16]]||sn[16]),
      productionYear: (yearMap[sn[14]]||''),
      batch: sn.substring(17)
    };
  }

  function renderBanner(info){
    const h = document.getElementById('highlight');
    if(!info){
      h.innerHTML = '';
      return;
    }
    const year = info.productionYear || 'â€”';
    const volt = info.voltage || 'â€”';
    h.innerHTML = `
      <div class="highlight-wrap">
        <div class="highlight" role="status" aria-live="polite">
          <span class="pill">GRADE A</span>
          <span>Cells by <strong>GREAT POWER</strong></span>
          <span class="sep">â€¢</span>
          <span>${year}</span>
          <span class="sep">â€¢</span>
          <span>${volt}</span>
        </div>
      </div>`;
  }

  function renderTable(info){
    const out=document.getElementById('out');
    if(!info){out.innerHTML='<div style="color:#666">No data decoded yet.</div>';return;}
    out.innerHTML=`
      <div class="field"><span class="label">Raw serial</span><div class="value">${info.raw}</div></div>
      <div class="field"><span class="label">Manufacturer</span><div class="value">${info.manufacturer}</div></div>
      <div class="field"><span class="label">Series</span><div class="value">${info.series}</div></div>
      <div class="field"><span class="label">Version</span><div class="value">${info.version}</div></div>
      <div class="field"><span class="label">Voltage</span><div class="value">${info.voltage}</div></div>
      <div class="field"><span class="label">Capacity</span><div class="value">${info.capacity}</div></div>
      <div class="field"><span class="label">Production Line</span><div class="value">${info.productionLine}</div></div>
      <div class="field"><span class="label">Factory Base</span><div class="value">${info.factoryBase}</div></div>
      <div class="field"><span class="label">Production Date</span><div class="value">${info.productionDate}</div></div>
      <div class="field"><span class="label">Batch</span><div class="value">${info.batch}</div></div>
    `;
  }

  document.getElementById('decodeBtn').addEventListener('click',()=>{
    const info = decodeSerial(document.getElementById('qr').value);
    renderBanner(info);
    renderTable(info);
  });

  let html5QrCode;
  const readerDiv=document.getElementById('reader');
  const startBtn=document.getElementById('startScan');
  const stopBtn=document.getElementById('stopScan');

  startBtn.addEventListener('click',()=>{
    if(!ensureLib()){ alert('QR library did not load. Check CDN or host locally.'); return; }
    navigator.mediaDevices.getUserMedia({video:true}).then(stream=>{
      stream.getTracks().forEach(t=>t.stop());
      readerDiv.style.display='block';startBtn.style.display='none';stopBtn.style.display='inline-block';
      html5QrCode=new Html5Qrcode('reader');
      html5QrCode.start({facingMode:"environment"},{fps:10,qrbox:250},msg=>{
        document.getElementById('qr').value=msg;
        const info = decodeSerial(msg);
        renderBanner(info);
        renderTable(info);
      },()=>{}).catch(e=>alert('Camera start failed: '+e));
    }).catch(err=>alert('Camera permission denied: '+err));
  });

  stopBtn.addEventListener('click',()=>{
    if(html5QrCode){
      html5QrCode.stop().then(()=>{
        readerDiv.style.display='none';stopBtn.style.display='none';startBtn.style.display='inline-block';
      });
    }
  });
});
  </script>
</head>
<body>
  <div class="card">
    <img class="logo" src="https://i.postimg.cc/v8CLk3Nv/Screenshot-2025-09-28-104524.png" alt="BEVE Power Logo" />
    <h2>Battery QR Code Decoder</h2>
    <p class="hint">Enter a serial number or scan using your deviceâ€™s camera.</p>

    <label for="qr">QR / Serial Number</label>
    <input id="qr" type="text" placeholder="Example: 02KCBB416280GCF4P1101411" />

    <div class="row">
      <div class="col"><button id="decodeBtn">Decode Information</button></div>
      <div class="col">
        <button id="startScan">ðŸ“· Activate Camera</button>
        <button id="stopScan" style="display:none;">Stop Camera</button>
      </div>
    </div>

    <div id="reader"></div>

    <!-- Compact centered banner ABOVE the table -->
    <div id="highlight"></div>

    <!-- Original table remains unchanged below -->
    <div id="out" class="result"><div style="color:#666">No data decoded yet.</div></div>

    <footer>HTTPS is required for camera access on the web.</footer>
  </div>
</body>
</html>
